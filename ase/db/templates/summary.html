<!DOCTYPE html>
<html>
  <head>

    <title>Browse 2D Materials</title>
    <meta name="viewport" content="width-device-width, initial-scale=1.0"> 

		{% include '/static2D/style2D.css' %}
		{% include '/static2D/js.html' %}

</head>
<body>

  {% set d = s.row %}
  {% set secs = md['METASections'] %}
  {% set meta = md['METACol'] %}

  <!-- a little setup-->
  {% set SPECIAL = ['STRUCTUREPLOT', 'AXIS', 'FORCES', 'BANDSTRUCT'] %}
  {% set plotband = {'plot': false} %}

  {% set keyval = {} %}

  {% for name, unit, value in s.table %}
  {% set _dummy = keyval.update({name : (unit, value)}) %}
  {% endfor %}

  {% for key, value in s.key_value_pairs %}
  {% set _dummy = keyval.update({key: ('eV', value)}) %}
  {% endfor %}

  <div class="container">

    <p></p>

    {% for name, unit, value in s.table %}
    {% if name == "formula" %}
    {% set formulaStr = value|safe %}
    <h1>
    {{ value|safe }}
    </h1>
    {% endif %}
    {% endfor %}

    <div class="panel-group">

      {% set secCount = {'count' : 0} %}
      {% for sec in secs %}
      {% set _dummy = secCount.update({'count' : secCount['count']+1}) %}
      
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a class="btn-block" data-toggle="collapse" href="#collapse{{secCount['count']}}">
              {{ sec[0] }}
            </a>
          </h4>
        </div>
        {% if secCount['count'] == 1 %}
        <div id="collapse{{secCount['count']}}" class="panel-collapse collapse in">
        {%else%}
        <div id="collapse{{secCount['count']}}" class="panel-collapse collapse">
        {% endif %}
          <div class="panel-body">
            {% set half = ((sec|length)/2) | int %} <!-- careful with jinja2 parsing -->
            
            <div class="row myrow">
              
              <div class="col-xs-1"></div>
              <div class="col-xs-5">
                {% for index in range(1, sec|length) %}
                
                {% if index == half+1 %}
                </div>
                <div class="col-xs-5">
                {% endif %}
                
                {% if not sec[index][0] in SPECIAL %}
                <table class="table table-striped">
                  <colgroup>
                    <col class="col-md-7">
                    <col class="col-md-3">
                    <col class="col-md-2">
                  </colgroup> 
                  <thead>
                    <tr>
                      <th>{{sec[index][0]}}</th>
                      <th>Value</th>
                      <th>Unit</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for item in range(0, sec[index][1]|length) %}                    
                    {% set name = sec[index][1][item] %}                    
                    {% if (name in meta) and (name in keyval) %}
                    <tr>

                      <td> {{ meta[name][1] }} </td>

                      {% if meta[name][2] == 'float' %}
                      <td> {{ keyval[name][1] | round(3, 'common') }} </td>
                      {% else %}
                      <td> {{ keyval[name][1] | safe }} </td>
                      {% endif %}

                      {% if meta[name][2] == 'float' %}
                      <td> {{ keyval[name][0] }} </td>
                      {% else %}
                      <td> - </td>
                      {% endif %}

                    </tr>
                    {% endif %}
                    {% endfor %}
                  </tbody>
                </table>
                {% else %}

                  {% if sec[index][0] == 'STRUCTUREPLOT' %}
                  
                    {% if d.numbers|length %}
                    {% if open_ase_gui %}
                    <a href="/gui/{{ d.id }}">
                      <img src="/image/{{ d.id }}.png">
                    </a>
                    {% else %}
                    <div id="appdiv"></div>
                    Unitcell: <button onclick="repeatCell(1)"> Single </button>
                    <button onclick="repeatCell(2)"> 2x2x2</button>

                    {% endif %}
                    {% endif %}
                    
                  {% elif sec[index][0] == 'AXIS' %}
                  
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th>Axis</th>
                          <th>x</th>
                          <th>y</th>
                          <th>z</th>
                          <th>Periodic</th>
                        </tr>
                      </thead>
                      <tbody>

                        {% for axis in s.cell %}
                        <tr>
                          <td>{{ loop.index }}</td>
                          {% for a in axis %} <td>{{ a }}</td>{% endfor %}
                          <td>{{ d.pbc[loop.index0] }}</td>
                        </tr>
                        {% endfor %}

                      </tbody>
                    </table>

                  {% elif sec[index][0] == 'FORCES' %}

                    {% if s.forces %}
                    <h4>Relaxtion forces in eV/Ã¥</h4>
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th>#</th>
                          <th>symbol</th>
                          <th>x</th>
                          <th>y</th>
                          <th>z</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for f in s.forces %}
                        <tr>
                          <td>{{ f[0] }}</td>
                          <td>{{ f[1] }}</td>
                          <td>{{ f[2] }}</td>
                          <td>{{ f[3] }}</td>
                          <td>{{ f[4] }}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                    {% endif %}

                  {% elif sec[index][0] == 'BANDSTRUCT' %}

                  {% set _dummy = plotband.update({'plot': true}) %}

                  {% endif%}

                  {% endif %}
                  {% endfor %}

                </div>            
              <div class="col-xs-1"></div>

            </div> <!--END ROW-->

            <!--if there is a band structure put it here -->
            {% if plotband['plot'] == true %}
            <div class="row">
              <div class="col-sm-1"></div>
              <div class="col-sm-10">
                <center>
                  {% for name in s.plots %}
                  <img src="/plot/{{ name }}-{{ d.id }}.png">                  
                  {% endfor %}
                </center>
              </div>
              <div class="col-sm-1"></div>
            </div>
            {% set _dummy = plotband.update({'plot': false}) %}
            {% endif%}

          </div> <!--END PANEL BODY-->
        </div> <!--END COLLAPSE-->
      </div> <!--END PANEL-->
    {% endfor %}
  </div> <!--END PANEL GROUP-->

</body>
</html>